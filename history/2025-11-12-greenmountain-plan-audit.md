# PLAN Alignment – Orchestrator & DSPy (2025-11-12 · GreenMountain)

## Scope
Quick checkpoint against `docs/PLAN.md` §§1–4 and `docs/PoC.md` to clarify which CourseGen pillars are implemented, partially wired, or missing as of 12 Nov 2025. Focus is on the Teacher RLM + DSPy CodeAct stack, world-model ingestion, grader loop, Notebook export, and the newly requested FE/BE portal.

## Status by Pillar
| Pillar (PLAN ref) | Implementation snapshot | Gaps / next actions |
| --- | --- | --- |
| **Teacher RLM + recursive TAs** (`docs/PLAN.md:151-340`) | `apps/orchestrator/teacher.py:13-60` still raises `NotImplementedError`; no `RLM_REPL` wiring or `use_codeact`/`spawn_ta` bridge exists. Shared-state + config plumbing already in place. | Need to wrap `vendor/rlm` per PLAN (§4.3), expose the REPL helpers, and call the real CodeAct programs. Track under `ccopilot-syy`; suggest adding sub-beads for REPL env + prompt policies once current reservations free up. |
| **CodeAct + DSPy programs** (`docs/PLAN.md:228-340`) | `apps/codeact/signatures.py` + `programs.py:1-86` now declare true `dspy.Signature` subclasses and factories; `apps/orchestrator/codeact_registry.py:12-82` registers tools/programs and now consumes `DSPyModelHandles`. | Programs are wired but no orchestrator stage triggers them yet; `apps/codeact/tools_data.py:11-17` still unimplemented (DuckDB SQL). Need to finish SQL tool, ensure program outputs persist to world model, and add integration tests exercising a CodeAct run with the mocked LM handles. |
| **DSPy/OpenAI runtime** (`docs/PLAN.md:97-114`) | `ccopilot/core/dspy_runtime.py` + `ccopilot/pipeline/bootstrap.py:70-118` configure teacher/TA/student LMs using `OPENAI_API_KEY`. `tests/test_dspy_runtime.py` + `tests/test_pipeline_runtime.py` assert `build_default_registry(dspy_handles=…)`. | Next: swap the dummy `dspy.LM` fallback for `dspy.OpenAI` once the environment provides real API keys (already placed in `.env` per overseer). Capture a non-dry CLI run that exercises the CodeAct registry to prove real LM calls (record request IDs in provenance). |
| **Symbolic world model + ingestion** (`docs/PLAN.md:200-266`) | `scripts/ingest_handcrafted.py` + `world_model/adapters.py` create/serve SQLite snapshots; CodeAct tools wrap read/write APIs (`apps/codeact/tools/world_model.py:1-78`). CLI flag `--ingest-world-model` rebuilds when needed. | Need automated validation of concept/timeline completeness vs PLAN Appendix (counts, required papers). Consider nightly ingest test referencing `docs/samples/`. Also extend CodeAct tools to support writes beyond `record_claim` (e.g., relationships, outline modules) per PLAN §2. |
| **Grader / self-evolving loop** (`docs/PLAN.md:266-322`) | Deterministic graders live in `apps/orchestrator/students.py:1-200`; CLI re-run supported via `apps/orchestrator/eval_loop.py`. Configurable rubrics live under `evals/`. | Mutation loop + prompt rewrites described in PLAN §C aren’t implemented; graders only compute static heuristics. Need bead for “self-evolving” policy updates plus wiring so failed rubrics trigger CodeAct reruns before publishing. |
| **Notebook publishing** (`docs/PLAN.md:282-309`) | `apps/codeact/tools/open_notebook.py:1-134` wraps the HTTP client and mirrors offline exports. Config bootstrap already exports `OPEN_NOTEBOOK_*` env vars. | Real API pushes require `OPEN_NOTEBOOK_API_BASE` in config; currently CLI defaults to offline export. Need integration test hitting a mocked FastAPI server (or the new portal backend) so we can assert Notebook requests succeed. |
| **CLI / ablations / provenance** (`docs/PLAN.md:266-286`) | `ccopilot/cli/run_poc.py` exposes the required flags; `ccopilot/core/ablation.py` + `PipelineContext` wire toggles; provenance logging persists to `outputs/logs`. | To meet “one command runs full pipeline,” we still need the teacher loop + CodeAct integration plus Notebook push. Document CLI usage in README once real path is end-to-end. |
| **FE/BE portal (new directive)** | `apps/portal_backend` + `frontend/` scaffolded by OrangeMountain (see inbox msg `ccopilot-m6z`); README now describes `uvicorn` + `pnpm dev` flow. | Portal currently surfaces manifest snapshots only. Next: show live CodeAct traces, Notebook links, and allow re-triggering runs (`NEXT_PUBLIC_TRIGGER_RUN_URL`). Coordinate once backend API stabilizes. |

## Detailed Notes
1. **Teacher orchestrator still stubbed** – `apps/orchestrator/teacher.py:34-45` exits immediately. PLAN §4.3 requires embedding the `vendor/rlm` REPL and exposing helpers (`use_codeact`, `spawn_ta`, WM CRUD). Recommend breaking `ccopilot-syy` into: (a) RLM bootstrap, (b) TA prompt packs, (c) run ledger + provenance.
2. **CodeAct data tools incomplete** – `apps/codeact/tools_data.py:11-17` raises `NotImplementedError`. PLAN §2 expects DuckDB-powered analytics for TA reasoning. Blocker for real CodeAct loops; should either stub deterministic returns or complete the DuckDB wiring with dataset inputs (`data/handcrafted/**`).
3. **World-model writes partially covered** – `apps/codeact/tools/world_model.py` exposes `record_claim`/`list_*`, but PLAN calls for `wm_link`, timeline append, course outline writes. We’ll need adapter methods in `world_model/adapters.py` before TA programs can mutate the graph.
4. **Evaluation loop lacks mutation** – Student graders exist, but there’s no “self-evolving” retry or prompt mutation pipeline described in PLAN Phase C. Suggest new bead for `StudentMutationLoop` that inspects failing rubrics and patches prompt templates/constraints before re-running CodeAct.
5. **Notebook integration currently optional** – `push_notebook_section` requires `OPEN_NOTEBOOK_API_BASE`; README only documents offline export. Given the overseer’s push for “real API calls,” we should default to the provided `.env` base URL and add a smoke test using the FastAPI portal backend as a fake Notebook service.
6. **Portal & audit coordination** – OrangeMountain is already tackling `ccopilot-lrm` (full PLAN audit) and the portal (`ccopilot-m6z`). This note narrows in on the RLM/DSPy slice so we can divide and conquer. I’ll sync once their audit doc lands to avoid duplicate tracking.

## Suggested Follow-ups
1. **ccopilot-syy sub-beads** for `RLM_REPL` integration + TA prompt wiring (owner TBD).
2. **New bead:** “Implement DuckDB-backed CodeAct data tools” to unblock TA programs.
3. **New bead:** “Self-evolving grader loop” to add mutation + retry logic.
4. **QA bead:** “Notebook push smoke tests” leveraging portal backend as mock server.
5. **Docs:** Update README + `docs/PoC.md` once the DSPy registry + CLI are truly end-to-end (include env var guidance for Notebook + OpenAI).

Let me know where you’d like me to dive deeper next (e.g., RLM REPL integration or portal API tests).
